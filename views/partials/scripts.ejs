<script src="/public/js/main.js"></script>
<script>
    // Make user data available globally
    window.currentUser = <%- JSON.stringify(locals.user || null) %>;
    
    // Initialize socket connection if user is authenticated
    if (window.currentUser) {
        const token = localStorage.getItem('token') || getCookie('token');
        if (token) {
            window.socket = io({
                auth: {
                    token: token
                }
            });
            
            // Handle real-time notifications
            window.socket.on('notification', (notification) => {
                showNotification(notification);
            });
            
            window.socket.on('post_like', (data) => {
                updateLikeCount(data.postId, data.totalLikes, data.isLiked);
            });
            
            window.socket.on('post_comment', (data) => {
                updateCommentCount(data.postId, data.totalComments);
                addCommentToPost(data.postId, data.comment);
            });
        }
    }
    
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
</script>